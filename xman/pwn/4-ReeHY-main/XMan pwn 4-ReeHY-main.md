## XMan pwn 4-ReeHY-main

### 题目分析

查询题目保护开启，发现只开了NX，未开启RELRO和PIE，思路可以从修改got表展开。

(有libc动态链接，所以可以利用got表泄露libc地址)

 ![img](https://img2018.cnblogs.com/blog/1320115/201810/1320115-20181031205248257-682080786.png)

 

ida装载分析程序执行流程，main函数发现是一个常规的菜单类题目，推测为堆相关题目。

 ![img](https://img2018.cnblogs.com/blog/1320115/201810/1320115-20181031205254761-1639176030.png)

 

Malloc函数。分配最大不超过4096，且如果大小超过112就直接放入堆区，否则先存入栈区，再拷贝到堆区。存在结构体保存堆大小、堆指针以及标记是否分配。

 ![img](https://img2018.cnblogs.com/blog/1320115/201810/1320115-20181031205303557-681195291.png)

 ![img](https://img2018.cnblogs.com/blog/1320115/201810/1320115-20181031205309640-522842221.png)

 

Delete函数。直接删除，并没有判断标记是否被删除。删除后标记置0，但是未进行指针置0，存在uaf情况，可利用点为double free。观察没有判断输入为负的情况，可能存在问题。

 ![img](https://img2018.cnblogs.com/blog/1320115/201810/1320115-20181031205314616-1936050522.png)

 

Edit函数。判断是否被释放，未被释放才可以编辑。向堆区输入长度为申请时结构体保存的长度的字符串。

 ![img](https://img2018.cnblogs.com/blog/1320115/201810/1320115-20181031205320650-1162129729.png)

 

Show功能无效

 ![img](https://img2018.cnblogs.com/blog/1320115/201810/1320115-20181031205326326-340105415.png)

 

利用思路：

从free函数分析来看，首先未判断free的块号是否为负，可能存在释放后再申请内存不缺定的情况，可能分配到关键地方。

 